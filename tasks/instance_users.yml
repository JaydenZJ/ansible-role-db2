---
# As mentioned by IBM if you set password,uid,gid,group_name 
# If you provide at least user,password and group_name DB2 setup will create those users
# TODO: Use the new block feature since `when` clause is equal on all tasks

- name: Creating DB2 Fenced Groups
  group: name="{{item.fenced_group_name}}" state=present
  when: item.options is not defined or item.options.fenced_password is not defined
  with_items: db2_instances

- name: Creating DB2 Instance Groups
  group: name="{{item.group_name}}" state=present
  when: item.options is not defined or item.options.password is not defined
  with_items: db2_instances

- name: Creating DB2 Instance Users
  user:
    name: "{{item.name}}"
    group: "{{item.group_name}}"
    password: ldUMKEu7/QCAY
    home: "/home/{{item.name}}"
  when: item.options is not defined or item.options.password is not defined
  with_items: db2_instances

- name: Creating DB2 Fenced Users
  user:
    name: "{{item.fenced_username}}"
    group: "{{item.fenced_group_name}}"
    password: ldUMKEu7/QCAY
    home: "/home/{{item.fenced_username}}"
  when: item.options is not defined or item.options.fenced_password is not defined
  with_items: db2_instances